# Cadaster/Canon Zone

See [[Concepts#Canon|the glossary]] for a definition of "canon". This directory contains
nixosconfigurations for all the nixos machines in the purview of telperion. There are some machines
that exist outside of that purview, they are:

1. `kepler`, a windows-based machine I use to drive my astrophotography rig. Much of the software is
   windows-only, so it can't be nixos-based.
2. `work` and `hedges` are both nix-darwin, the former is employer-issued and my ability to
   configure it is therefore limited, the latter is my studio machine and doesn't need any more than
   basic configuration. They both use nix-darwin and home-manager directly from `glamdring`.
3. `nancy` is a Synology NAS that I use for backups and media storage.
4. `voltaire` and `condorcet` are switches, and their `canon` entries point to the switch's default
   IP. The are not managed by nix.

For these machines which are not fully nixos, the only thing in the `default.nix` is the
`laurelin.infra.dns` module, they are expected to have any backend IP configuration done by hand.

For the other machines, the `default.nix` pulls in all other relevant machine-level configuration to
set up any physical components of the machine, e.g., filesystems, etc.

Each machine directory may also have a few supporting files:

- README.mkd - Describes the machine, what it's used for, etc.
- CHANGELOG.mkd - Describes physical changes to the machine over time. (i.e., new disks, new NICs,
  etc).
- LOG.mkd - Any other notes about the machine that aren't necessarily changes, but are worth
  tracking.


## IP Assignment Strategy

Within the `.canon` tld, there are second-level domains. That is, everything is follows the format
of `${hostname}.canon`. It maps to a single network, `10.255.0.0/16`.

Of this `/16`, the `10.255.0.0/24` network is reserved for specific items, including:

1. The network gateway at `10.255.0.1/32`
2. The network switch at `10.255.0.2/32`
3. The DNS server at `10.255.0.3/32`
4. The boot server at `10.255.0.4/32`
5. All remaining IPs within `10.255.0.0/24` are reserved for arbitrary future use.
6. All IPs in `10.255.1.0/16` are assigned to machines as needed.

These IPs may be virtual, and thus may point to clusters of machines hosted elsewhere. These may
also point to a machine that has a second address on this network. i.e., if I host DNS on a
particular, nonvirtual machine, it has a canon address in the `10.255.1.0/16` part of the network
and the VIP `10.255.0.3/32` also points to it's canon address.

The rest of the `/16` is used to provide a 'canonical' IP and route to each machine, the DNS is
generated by the `laurelin.infra.dns` module included in each NixOS configuration.

For each of the reserved items, it may be that not all of them are in use. E.g., I may only run a
single DNS server, or a single boot server. They may also be combined, e.g., I combine DNS, NTP, and
boot to a single physical host. In this case the machine will be assigned an IP from each range, but
they all coterminate.

## Machine Naming

Naming is freeform, but I tend to draw from a few naming strategies:

1. Most 'big' machines (anything rackmount) are named after demons/elements from the Apocalyptic
   Mythology of Christianity.
2. Most 'small' machines (SFF, Thinclients, etc), are named for things from the Wizard of Oz.
3. Most VMs are named for Dogs I've known.
4. Most 'normal' machines are named for mathematicians, philosophers, or scientists (if they are
   mine) or dinosaurs (if they are family machines).

I also use elvish a bit, and there are a few that don't follow this scheme. This only matters for
the _canon_, though, within a domain these machines may have other names distinct from their canon
name. Their `hostname` is always their canon name, but -- e.g., if I'm deploying a particular domain
which turns `babylon-the-great` into a database server running PostgreSQL, it's URL within the
domain will likely be `db.some.domain`, and not `babylon-the-great.some.domain`.



